<?xml version="1.0" encoding="UTF-8"?>
<!--

    Copyright (c) 2006 Volker Krause <vkrause@kde.org>
    Copyright (C) 2006 by Tobias Koenig <tokoe@kde.org>

    This library is free software; you can redistribute it and/or modify it
    under the terms of the GNU Library General Public License as published by
    the Free Software Foundation; either version 2 of the License, or (at your
    option) any later version.

    This library is distributed in the hope that it will be useful, but WITHOUT
    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Library General Public
    License for more details.

    You should have received a copy of the GNU Library General Public License
    along with this library; see the file COPYING.LIB.  If not, write to the
    Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
    02110-1301, USA.

-->


<!--
  Akonadi Database Schema Definition

  This file is used to generate database access code as well as the tables itself.

  Database element (root node, can contain table and relation elements)

  Table attributes (can contain column, reference and data elements)
  - name: The entity class name, the table will be named FooTable.

  Column attributes:
  - name: The column name, will be also used as accessor name in the entity class.
  - type: The C++ type of this column, the SQL type will be derived from that.
  - sqltype: The SQL type (optional), overwrites types derived from the C++ type.
  - default: Default value for entity class constructor.
  - refTable, refColumn: foreign key, also used to generate accessor methods for 1:n relations
  - methodName: method name to access referred records, the table name is used if not given
  - properties: SQL properties such as constraints

  Reference attributes (indication n:1 relations)
  - name: Used for naming the method during code generation
  - table: name of the table a n:1 relation exist
  - key: column name of the referenced table containing the foreign key

  Initial data:
  - columns: A comma separated list of column names
  - values: A comma separated and SQL-quoted list of values

  Relation elements define a n:m relation between two tables.
  Attributes:
  - table[12]: Table names
  - column[12]: Column names

-->
<database>

  <table name="CachePolicy">
    <column name="id" type="int" properties="NOT NULL PRIMARY KEY AUTOINCREMENT"/>
    <column name="name" type="QString" sqltype="VARCHAR(255)" properties="NOT NULL UNIQUE"/>
    <column name="expireTime" type="int" default="0" properties="NOT NULL">
      <comment>The time in minutes the cached parts should be kept.</comment>
    </column>
    <column name="offlineParts" type="QString">
      <comment>A list of item parts that should be kept for offline usage.</comment>
    </column>
    <data columns="name,expireTime,offlineParts" values="'None',0,''"/>
    <data columns="name,expireTime,offlineParts" values="'Temporary',60,'HEAD'"/>
    <data columns="name,expireTime,offlineParts" values="'Permanent',-1,'ALL'"/>
  </table>

  <table name="Resource">
    <column name="id" type="int" properties="NOT NULL PRIMARY KEY AUTOINCREMENT"/>
    <column name="name" type="QString" sqltype="VARCHAR(255)" properties="NOT NULL UNIQUE"/>
    <column name="cachePolicyId" type="int" refTable="CachePolicy" refColumn="id" properties="NOT NULL REFERENCES CachePolicy(id) DEFAULT 0">
      <comment>Default for all locations with undefined cachePolicy.</comment>
    </column>
    <reference name="locations" table="Location" key="resourceId"/>
    <data columns="name,cachePolicyId" values="'akonadi_search_resource',1"/>
  </table>

  <table name="Location">
    <column name="id" type="int" properties="NOT NULL PRIMARY KEY AUTOINCREMENT"/>
    <column name="remoteId" type="QString"/>
    <column name="name" type="QString" sqltype="VARCHAR(255)" properties="NOT NULL"/>
    <column name="parentId" type="int" refTable="Location" refColumn="id" methodName="parent" properties="DEFAULT 0 REFERENCES Location(id)"/>
    <index name="parentIndex" columns="parentId" unique="false"/>
    <reference name="children" table="Location" key="parentId"/>
    <column name="cachePolicyId" type="int" refTable="CachePolicy" refColumn="id" properties="REFERENCES CachePolicy(id)">
      <comment>Identifier of the cache policy that should be used for this
        collection. If NULL, the default should be used.</comment>
    </column>
    <column name="resourceId" type="int" refTable="Resource" refColumn="id" properties="NOT NULL REFERENCES Resource(id)"/>
    <column name="existCount" type="int"/>
    <column name="recentCount" type="int"/>
    <column name="unseenCount" type="int"/>
    <column name="firstUnseen" type="int"/>
    <column name="uidValidity" type="int">
      <comment>Needed for IMAP compatibility??</comment>
    </column>
    <reference name="items" table="PimItem" key="locationId"/>
    <reference name="attributes" table="LocationAttribute" key="locationId"/>
    <data columns="parentId,name,resourceId" values="0,'Search',1"/>
  </table>

  <table name="MimeType">
    <comment>This meta data is stored inside akonadi to provide fast access.</comment>
    <column name="id" type="int" properties="NOT NULL PRIMARY KEY AUTOINCREMENT"/>
    <column name="name" type="QString" sqltype="VARCHAR(255)" properties="NOT NULL UNIQUE"/>
    <data columns="name" values="'application/octet-stream'"/>
    <data columns="name" values="'message/rfc822'"/>
    <data columns="name" values="'text/calendar'"/>
    <data columns="name" values="'text/vcard'"/>
    <data columns="name" values="'inode/directory'"/>
  </table>

  <table name="PimItem">
    <column name="id" type="int" properties="NOT NULL PRIMARY KEY AUTOINCREMENT"/>
    <column name="remoteId" type="QByteArray"/>
    <column name="data" type="QByteArray"/>
    <column name="locationId" type="int" refTable="Location" refColumn="id" properties="REFERENCES Location(id)"/>
    <index name="locationIndex" columns="locationId" unique="false"/>
    <column name="mimeTypeId" type="int" refTable="MimeType" refColumn="id" properties="REFERENCES MimeType(id)"/>
    <column name="datetime" type="QDateTime" properties="DEFAULT CURRENT_TIMESTAMP">
      <comment>create/modified time</comment>
    </column>
    <column name="atime" type="QDateTime">
      <comment>read access time</comment>
    </column>
    <column name="dirty" type="bool">
      <comment>Indicates that this item has unsaved changes.</comment>
    </column>
  </table>

  <table name="Flag">
    <comment>This meta data is stored inside akonadi to provide fast access.</comment>
    <column name="id" type="int" properties="NOT NULL PRIMARY KEY AUTOINCREMENT"/>
    <column name="name" type="QString" sqltype="VARCHAR(255)" properties="NOT NULL UNIQUE"/>
    <data columns="name" values="'important'"/>
    <data columns="name" values="'has_attachment'"/>
    <data columns="name" values="'spam'"/>
    <data columns="name" values="'\Answered'"/>
    <data columns="name" values="'\Flagged'"/>
    <data columns="name" values="'\Deleted'"/>
    <data columns="name" values="'\Seen'"/>
    <data columns="name" values="'\Draft'"/>
  </table>

  <relation table1="PimItem" column1="id" table2="Flag" column2="id"/>

  <table name="Part">
    <column name="id" type="int" properties="NOT NULL PRIMARY KEY AUTOINCREMENT"/>
    <column name="name" type="QString" sqltype="VARCHAR(255)" properties="NOT NULL"/>
    <column name="data" type="QByteArray"/>
    <column name="datasize" type="int" properties="NOT NULL"/>
    <column name="pimItemId" type="int" refTable="PimItem" refColumn="id" properties="REFERENCES PimItem(id)"/>
    <column name="mimeTypeId" type="int" refTable="MimeType" refColumn="id" properties="REFERENCES MimeType(id)"/>
    <index name="pimItemIdNameIndex" columns="pimItemId,name" unique="true"/>
  </table>

  <relation table2="Flag" column2="id" table1="Part" column1="id"/>

  <relation table1="Location" column1="id" table2="MimeType" column2="id">
    <comment>Specifies allowed MimeType for a Location</comment>
  </relation>

  <table name="LocationAttribute">
    <column name="id" type="int" properties="NOT NULL PRIMARY KEY AUTOINCREMENT"/>
    <column name="locationId" type="int" refTable="Location" refColumn="id" properties="REFERENCES Location(id)"/>
    <column name="type" type="QByteArray" properties="NOT NULL"/>
    <column name="value" type="QByteArray"/>
    <index name="locationIndex" columns="locationId" unique="false"/>
  </table>

  <relation table1="Location" column1="id" table2="PimItem" column2="id">
    <comment>Used to associacte items with search folders.</comment>
  </relation>
</database>
