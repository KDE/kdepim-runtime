From dc7c6aaa85fc380004cff7677fd7c829d0d91585 Mon Sep 17 00:00:00 2001
From: Christian Mollekopf <chrigi_1@fastmail.fm>
Date: Wed, 1 May 2013 18:30:37 +0200
Subject: [PATCH] Don't crash in ResourceTask::separatorCharacter()

Fixes imap-testchangecollectiontask.
---
 resources/imap/resourcetask.cpp | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/resources/imap/resourcetask.cpp b/resources/imap/resourcetask.cpp
index 5b516e2..90733da 100644
--- a/resources/imap/resourcetask.cpp
+++ b/resources/imap/resourcetask.cpp
@@ -379,7 +379,8 @@ const QChar ResourceTask::separatorCharacter() const
   //If we create a toplevel folder, assume the separator to be '/'. This is not perfect, but detecting the right
   //IMAP separator is not straightforward for toplevel folders, and fixes bug 292418 and maybe other, where
   //subfolders end up with remote id's starting with "i" (the first letter of imap:// ...)
-  const QChar separator = ( parentCollection().remoteId() != rootRemoteId() ) ? parentCollection().remoteId().at( 0 ) : '/';
+  const QString parentRemoteId = parentCollection().remoteId();
+  const QChar separator = ( ( parentRemoteId != rootRemoteId() ) && !parentRemoteId.isEmpty() ) ? parentRemoteId.at( 0 ) : '/';
   return separator;
 }
 
-- 
1.8.1.4

